name: ğŸ”’ PR de homol vers main
'on':
  workflow_call:
    inputs:
      ADRESSE_GLOBAL:
        type: string
        required: true
        description: 'Var repo: prÃ©fixe global (ex: /var/www)'
      ADRESSE_LOCAL:
        type: string
        required: true
        description: 'Var repo: sous-dossier projet/app'
      remote_env:
        type: string
        required: true
        description: 'ENV: dev | homol | prod'
    secrets: {}
jobs:
  gate:
    name: ğŸ”’ Verifier la source de la PR vers main
    runs-on: ubuntu-latest
    steps:
    - name: ğŸ” Controle de la branche source
      id: check
      run: "echo \"### ContrÃ´le PR\" >> \"$GITHUB_STEP_SUMMARY\"\necho \"- Branche\
        \ source (head): \\`${{ github.head_ref }}\\`\" >> \"$GITHUB_STEP_SUMMARY\"\
        \necho \"- Branche cible (base):  \\`${{ github.base_ref }}\\`\" >> \"$GITHUB_STEP_SUMMARY\"\
        \n\nif [ \"${{ github.base_ref }}\" = \"main\" ] && [ \"${{ github.head_ref\
        \ }}\" != \"homol\" ]; then\n  MSG=\"\U0001F6AB PR refusÃ©e : seules les PR\
        \ de \\`homol\\` vers \\`main\\` sont autorisÃ©es.\"\n  echo \"$MSG\"\n  echo\
        \ \"$MSG\" >> \"$GITHUB_STEP_SUMMARY\"\n  exit 1\nfi\n\nOK=\"âœ… PR valide :\
        \ ${{ github.head_ref }} â†’ ${{ github.base_ref }}\"\necho \"$OK\"\necho \"\
        $OK\" >> \"$GITHUB_STEP_SUMMARY\"\n"
    - name: ğŸ’¬ Commenter la PR si invalide
      if: ${{ failure() }}
      uses: peter-evans/create-or-update-comment@v4
      with:
        issue-number: ${{ github.event.pull_request.number }}
        body: "\U0001F6AB **PR refusÃ©e**\n\n- **Cible** : `${{ github.base_ref }}`\n\
          - **Source** : `${{ github.head_ref }}`\n\nSeules les PR provenant de **`homol`**\
          \ peuvent Ãªtre fusionnÃ©es dans **`main`**.  \nMerci dâ€™ouvrir une PR **homol\
          \ â†’ main**.\n"
permissions:
  contents: read
  issues: write
  pull-requests: write
